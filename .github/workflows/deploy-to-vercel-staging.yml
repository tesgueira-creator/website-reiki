name: Deploy to Vercel (Staging)

on:
    push:
        branches: [staging]
    workflow_dispatch:
        inputs:
            vercel_token:
                description: "Vercel Token (from env variable)"
                required: false
                type: string

jobs:
    deploy-staging:
        name: Deploy to Vercel (staging)
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Deploy via Vercel API
              env:
                  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN_STAGING || '7mJjR0rpFuBfDxxoWGufZSyy' }}
              run: |
                  echo "Triggering Vercel deployment via API..."

                  # Call Vercel API to trigger a redeploy
                  curl -X POST \
                    "https://api.vercel.com/v13/deployments?forceNew=1" \
                    -H "Authorization: Bearer ${VERCEL_TOKEN}" \
                    -H "Content-Type: application/json" \
                    -d '{
                      "name": "website-reiki",
                      "gitSource": {
                        "ref": "${{ github.ref }}",
                        "repo": "${{ github.repository }}",
                        "type": "github"
                      }
                    }' 2>&1 | jq '.'
